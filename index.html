<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NafasBumi - Aksi Kecil, Nafas Baru Untuk Bumi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Earthy Harmony -->
    <!-- Application Structure Plan: SPA ini menggunakan struktur navigasi berbasis tab yang dikendalikan oleh JavaScript. Setiap item menu (Beranda, Wawasan, Aksi, Tentang) akan menampilkan/menyembunyikan bagian konten yang sesuai tanpa memuat ulang halaman. Pendekatan ini dipilih untuk menciptakan prototipe yang cepat dan mulus, memungkinkan pengguna untuk merasakan alur aplikasi multi-halaman dalam satu file. Struktur ini berpusat pada pengguna, memprioritaskan kemudahan eksplorasi konten dari Laporan Konsep dengan meniru navigasi situs web yang sebenarnya. Gemini API diintegrasikan untuk fitur dinamis. -->
    <!-- Visualization & Content Choices: 
        1. Statistik Dampak (Beranda): Goal(Informasi) -> Method(Blok HTML/Tailwind dengan angka besar & ikon unicode) -> Interaction(Statis) -> Justification(Menyajikan pencapaian secara cepat dan berdampak).
        2. Sumber Sampah Laut (Wawasan): Goal(Perbandingan) -> Method(Bagan Batang Horizontal Chart.js) -> Interaction(Tooltip saat hover) -> Justification(Visualisasi data ini lebih menarik daripada teks biasa dan secara efektif memenuhi kebutuhan "Fakta & Data" dari laporan, menunjukkan perbandingan sumber polusi secara jelas).
        3. Perencana Aksi Hijau (Aksi): Goal(Solusi) -> Method(Input pengguna, panggilan Gemini API) -> Interaction(Pengguna mengetik topik, AI menghasilkan rencana) -> Justification(Memberikan solusi yang dipersonalisasi dan dapat ditindaklanjuti, meningkatkan keterlibatan).
        4. Jelajahi Topik (Wawasan): Goal(Edukasi) -> Method(Input pengguna, panggilan Gemini API) -> Interaction(Pengguna bertanya, AI menjawab) -> Justification(Mengubah konsumsi informasi pasif menjadi eksplorasi aktif).
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FDFBF5;
            color: #3f3f46;
        }
        .nav-link {
            transition: color 0.3s, border-bottom-color 0.3s;
            border-bottom: 2px solid transparent;
        }
        .nav-link.active, .nav-link:hover {
            color: #2E5339;
            border-bottom-color: #2E5339;
        }
        .hero-bg {
            background-image: url('https://images.unsplash.com/photo-1441974231531-c6227db76b6e?q=80&w=2560&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #2E5339;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="antialiased">

    <header class="bg-white/80 backdrop-blur-sm sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" class="text-2xl font-bold text-[#2E5339]">NafasBumi</a>
            <div class="hidden md:flex items-center space-x-8">
                <a href="#beranda" class="nav-link active">Beranda</a>
                <a href="#wawasan" class="nav-link">Wawasan</a>
                <a href="#aksi" class="nav-link">Aksi</a>
                <a href="#tentang" class="nav-link">Tentang Kami</a>
            </div>
            <a href="#" class="hidden md:block bg-[#2E5339] text-white px-5 py-2 rounded-full hover:bg-[#4A7859] transition-colors">Donasi</a>
            <button id="mobile-menu-button" class="md:hidden text-2xl">‚ò∞</button>
        </nav>
        <div id="mobile-menu" class="hidden md:hidden bg-white p-4">
             <a href="#beranda" class="block py-2 px-4 text-sm nav-link active">Beranda</a>
             <a href="#wawasan" class="block py-2 px-4 text-sm nav-link">Wawasan</a>
             <a href="#aksi" class="block py-2 px-4 text-sm nav-link">Aksi</a>
             <a href="#tentang" class="block py-2 px-4 text-sm nav-link">Tentang Kami</a>
             <a href="#" class="block mt-2 w-full text-center bg-[#2E5339] text-white px-5 py-2 rounded-full hover:bg-[#4A7859] transition-colors">Donasi</a>
        </div>
    </header>

    <main>
        <section id="beranda" class="content-section">
            <div class="hero-bg text-white">
                <div class="bg-black/50 min-h-[60vh] flex items-center">
                    <div class="container mx-auto px-6 text-center">
                        <h1 class="text-4xl md:text-6xl font-bold mb-4">Aksi Kecil Kita,</h1>
                        <h2 class="text-4xl md:text-6xl font-bold mb-8">Nafas Baru Untuk Bumi.</h2>
                        <p class="text-lg md:text-xl max-w-3xl mx-auto mb-8">Mari bergabung dalam gerakan untuk menjaga kelestarian alam Indonesia demi masa depan yang lebih hijau dan sehat.</p>
                        <a href="#aksi" class="bg-white text-[#2E5339] font-bold px-8 py-4 rounded-full hover:bg-gray-200 transition-colors">Mulai Beraksi</a>
                    </div>
                </div>
            </div>

            <section class="py-16 bg-white">
                <div class="container mx-auto px-6">
                    <h3 class="text-3xl font-bold text-center mb-2">Sorotan Berita</h3>
                    <p class="text-center text-gray-600 mb-12 max-w-2xl mx-auto">Ikuti perkembangan terbaru mengenai isu lingkungan, kisah inspiratif, dan analisis mendalam dari para ahli.</p>
                    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                        <div class="bg-stone-50 rounded-lg overflow-hidden shadow-lg hover:shadow-xl transition-shadow">
                            <img src="https://images.unsplash.com/photo-1593281488421-d4a34b2c1782?q=80&w=1287&auto=format&fit=crop" onerror="this.onerror=null;this.src='https://placehold.co/600x400/2E5339/FDFBF5?text=Hutan';" alt="Hutan" class="w-full h-48 object-cover">
                            <div class="p-6">
                                <span class="text-sm text-[#2E5339] font-semibold">ANALISIS</span>
                                <h4 class="font-bold text-xl my-2">Mengapa Sampah Plastik di Laut Indonesia Sulit Diatasi?</h4>
                                <p class="text-gray-600 text-sm">Sebuah tinjauan komprehensif tentang tantangan struktural dan kultural dalam penanganan sampah laut.</p>
                            </div>
                        </div>
                        <div class="bg-stone-50 rounded-lg overflow-hidden shadow-lg hover:shadow-xl transition-shadow">
                            <img src="https://images.unsplash.com/photo-1611082594498-6e59276d4cb3?q=80&w=1287&auto=format&fit=crop" onerror="this.onerror=null;this.src='https://placehold.co/600x400/2E5339/FDFBF5?text=Aksi+Tanam';" alt="Orang menanam" class="w-full h-48 object-cover">
                            <div class="p-6">
                                <span class="text-sm text-[#2E5339] font-semibold">KISAH INSPIRATIF</span>
                                <h4 class="font-bold text-xl my-2">Pemuda Desa X Ubah Sampah Jadi Berkah</h4>
                                <p class="text-gray-600 text-sm">Kisah komunitas di lereng gunung yang berhasil membangun sistem pengelolaan sampah mandiri dan berkelanjutan.</p>
                            </div>
                        </div>
                        <div class="bg-stone-50 rounded-lg overflow-hidden shadow-lg hover:shadow-xl transition-shadow">
                             <img src="https://images.unsplash.com/photo-1621258959218-a61ed5603d7c?q=80&w=1334&auto=format&fit=crop" onerror="this.onerror=null;this.src='https://placehold.co/600x400/2E5339/FDFBF5?text=Energi+Hijau';" alt="Panel surya" class="w-full h-48 object-cover">
                            <div class="p-6">
                                <span class="text-sm text-[#2E5339] font-semibold">BERITA TERKINI</span>
                                <h4 class="font-bold text-xl my-2">Pemerintah Targetkan Bauran Energi Terbarukan 23% di 2025</h4>
                                <p class="text-gray-600 text-sm">Langkah dan kebijakan baru diperkenalkan untuk mengakselerasi transisi menuju energi bersih di Indonesia.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

             <section class="py-16">
                <div class="container mx-auto px-6">
                    <div class="bg-[#2E5339] text-white rounded-lg p-10 md:p-16 text-center">
                        <h3 class="text-3xl font-bold mb-4">Kampanye Mendesak: Lindungi Hutan Terakhir Kita!</h3>
                        <p class="mb-8 max-w-3xl mx-auto">Setiap menit, puluhan hektar hutan hujan kita hilang. Suara Anda sangat berarti untuk mendorong pemerintah memperketat pengawasan dan menindak tegas para perusak hutan.</p>
                        <a href="#aksi" class="bg-white text-[#2E5339] font-bold px-8 py-4 rounded-full hover:bg-gray-200 transition-colors">Tanda Tangan Petisi</a>
                    </div>
                </div>
            </section>
            
            <section class="py-16 bg-white">
                <div class="container mx-auto px-6 text-center">
                    <h3 class="text-3xl font-bold mb-2">Dampak Aksi Kita Bersama</h3>
                    <p class="text-center text-gray-600 mb-12 max-w-2xl mx-auto">Setiap kontribusi, sekecil apa pun, menciptakan gelombang perubahan yang besar. Ini adalah pencapaian kita semua.</p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="bg-stone-50 p-8 rounded-lg shadow">
                            <div class="text-5xl mb-4">‚úçÔ∏è</div>
                            <p class="text-4xl font-bold text-[#2E5339]">58.109</p>
                            <p class="text-gray-600 mt-2">Tanda Tangan Terkumpul untuk Kampanye Lingkungan</p>
                        </div>
                        <div class="bg-stone-50 p-8 rounded-lg shadow">
                            <div class="text-5xl mb-4">üå≥</div>
                            <p class="text-4xl font-bold text-[#2E5339]">12.500+</p>
                            <p class="text-gray-600 mt-2">Pohon Telah Ditanam Melalui Donasi Publik</p>
                        </div>
                        <div class="bg-stone-50 p-8 rounded-lg shadow">
                            <div class="text-5xl mb-4">ü§ù</div>
                            <p class="text-4xl font-bold text-[#2E5339]">78</p>
                            <p class="text-gray-600 mt-2">Komunitas Lokal Telah Menjadi Mitra Aksi Hijau</p>
                        </div>
                    </div>
                </div>
            </section>
        </section>

        <section id="wawasan" class="content-section hidden min-h-screen py-16">
            <div class="container mx-auto px-6">
                <h2 class="text-4xl font-bold text-center mb-4">Pojok Wawasan</h2>
                <p class="text-center text-gray-600 mb-12 max-w-3xl mx-auto">Informasi adalah langkah pertama menuju perubahan. Dapatkan data, pemahaman mendalam, dan jelajahi topik lingkungan dengan bantuan AI.</p>

                <div class="bg-white p-8 rounded-lg shadow-lg mb-16">
                    <h3 class="text-2xl font-bold mb-2 text-center">‚ú® Jelajahi Topik Lingkungan</h3>
                    <p class="text-center text-gray-500 mb-8">Punya pertanyaan tentang isu lingkungan? Tanyakan di sini dan dapatkan penjelasan sederhana dari AI.</p>
                    <div class="max-w-2xl mx-auto">
                        <textarea id="topic-input" class="w-full p-3 border rounded mb-4" rows="3" placeholder="Contoh: Apa itu jejak karbon dan bagaimana cara menguranginya?"></textarea>
                        <button id="explore-topic-btn" class="w-full bg-[#2E5339] text-white p-3 rounded-lg font-bold hover:bg-[#4A7859] transition-colors flex items-center justify-center">
                            Jelajahi Sekarang
                        </button>
                        <div id="topic-loader" class="hidden justify-center mt-4"><div class="loader"></div></div>
                        <div id="topic-result" class="mt-6 bg-stone-50 p-6 rounded-lg hidden"></div>
                    </div>
                </div>
                
                <div class="bg-white p-8 rounded-lg shadow-lg">
                    <h3 class="text-2xl font-bold mb-2 text-center">Visualisasi Data: Komposisi Sampah di Laut Indonesia</h3>
                    <p class="text-center text-gray-500 mb-8">Berdasarkan data dari LIPI (sekarang BRIN), sampah plastik mendominasi lautan kita. Memahami sumbernya membantu kita menentukan prioritas penanganan.</p>
                    <div class="chart-container">
                        <canvas id="wasteChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <section id="aksi" class="content-section hidden min-h-screen py-16">
             <div class="container mx-auto px-6">
                <h2 class="text-4xl font-bold text-center mb-4">Zona Aksi</h2>
                <p class="text-center text-gray-600 mb-12 max-w-3xl mx-auto">Perubahan dimulai dari tindakan nyata. Dapatkan rencana aksi personal dari AI, dukung kampanye, dan terapkan gaya hidup hijau.</p>
                
                <div class="bg-white p-8 rounded-lg shadow-lg mb-16">
                    <h3 class="text-2xl font-bold mb-2 text-center">‚ú® Perencana Aksi Hijau</h3>
                    <p class="text-center text-gray-500 mb-8">Bingung mulai dari mana? Tulis topik yang Anda pedulikan, dan biarkan AI menyusun rencana langkah demi langkah untuk Anda.</p>
                    <div class="max-w-2xl mx-auto">
                        <input type="text" id="action-plan-input" class="w-full p-3 border rounded mb-4" placeholder="Contoh: Mengurangi sampah plastik di rumah">
                        <button id="generate-plan-btn" class="w-full bg-[#4A7859] text-white p-3 rounded-lg font-bold hover:bg-[#2E5339] transition-colors flex items-center justify-center">
                           Buatkan Rencana Aksi
                        </button>
                        <div id="plan-loader" class="hidden justify-center mt-4"><div class="loader"></div></div>
                        <div id="plan-result" class="mt-6 hidden"></div>
                    </div>
                </div>

                <div class="bg-white p-8 rounded-lg shadow-lg mb-12">
                    <h3 class="text-2xl font-bold text-center mb-6">Petisi Unggulan</h3>
                    <div class="flex flex-col md:flex-row items-center gap-8">
                        <div class="md:w-1/2">
                           <h4 class="text-3xl font-bold text-[#2E5339] mb-4">Hentikan Reklamasi di Pesisir Teluk Benoa!</h4>
                           <p class="text-gray-600 mb-6">Proyek reklamasi mengancam ekosistem mangrove yang krusial dan kehidupan nelayan lokal. Ribuan orang telah bersuara, kini giliran Anda.</p>
                           <div class="w-full bg-gray-200 rounded-full h-4 mb-2">
                               <div class="bg-[#2E5339] h-4 rounded-full" style="width: 75%"></div>
                           </div>
                           <p class="text-sm text-gray-600"><strong>75.480</strong> dari 100.000 target suara terkumpul.</p>
                        </div>
                        <div class="md:w-1/2 w-full">
                            <form class="bg-stone-50 p-6 rounded-lg">
                                <h5 class="font-bold text-lg mb-4">Ya, Saya Mendukung!</h5>
                                <input type="text" placeholder="Nama Lengkap" class="w-full p-3 border rounded mb-4">
                                <input type="email" placeholder="Alamat Email" class="w-full p-3 border rounded mb-4">
                                <button type="submit" class="w-full bg-[#2E5339] text-white p-3 rounded-lg font-bold hover:bg-[#4A7859] transition-colors">Tanda Tangan Sekarang</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="tentang" class="content-section hidden min-h-screen py-16">
            <div class="container mx-auto px-6 text-center max-w-4xl">
                 <h2 class="text-4xl font-bold text-center mb-4">Tentang NafasBumi</h2>
                 <p class="text-center text-gray-600 mb-12">Kami percaya bahwa informasi yang akurat, kepedulian yang tulus, dan aksi kolektif adalah kunci untuk masa depan bumi yang berkelanjutan.</p>
                 <img src="https://images.unsplash.com/photo-1579593343485-a74a1310b315?q=80&w=1287&auto=format&fit=crop" onerror="this.onerror=null;this.src='https://placehold.co/600x400/2E5339/FDFBF5?text=Tim+NafasBumi';" class="w-full h-80 object-cover rounded-lg shadow-lg mb-8" alt="Tim NafasBumi">
                 <div class="text-left bg-white p-8 rounded-lg shadow-lg">
                    <h3 class="text-2xl font-bold text-[#2E5339] mb-4">Misi Kami</h3>
                    <p class="text-gray-700 mb-4">NafasBumi adalah platform digital independen yang lahir dari kegelisahan akan kondisi lingkungan di Indonesia. Misi kami adalah menjadi sumber informasi lingkungan yang terpercaya, menyederhanakan data yang kompleks, dan yang terpenting, menjembatani kesadaran dengan tindakan nyata.</p>
                    <p class="text-gray-700">Kami bekerja untuk mengedukasi publik, mendorong kebijakan yang pro-lingkungan, dan membangun komunitas yang solid dan peduli. Setiap artikel yang kami tulis, setiap kampanye yang kami suarakan, dan setiap panduan yang kami bagikan adalah bagian dari upaya memberikan nafas baru untuk bumi pertiwi.</p>
                 </div>
            </div>
        </section>
    </main>

    <footer class="bg-[#1c3323] text-white mt-16">
        <div class="container mx-auto px-6 py-12">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h4 class="text-lg font-bold mb-4">NafasBumi</h4>
                    <p class="text-gray-400 text-sm">Aksi Kecil Kita, Nafas Baru Untuk Bumi.</p>
                </div>
                <div>
                    <h5 class="font-semibold mb-4">Tautan Cepat</h5>
                    <ul class="space-y-2 text-sm">
                        <li><a href="#wawasan" class="hover:text-gray-300">Wawasan</a></li>
                        <li><a href="#aksi" class="hover:text-gray-300">Aksi</a></li>
                        <li><a href="#tentang" class="hover:text-gray-300">Tentang Kami</a></li>
                    </ul>
                </div>
                <div>
                    <h5 class="font-semibold mb-4">Legal</h5>
                     <ul class="space-y-2 text-sm">
                        <li><a href="#" class="hover:text-gray-300">Kebijakan Privasi</a></li>
                        <li><a href="#" class="hover:text-gray-300">Syarat & Ketentuan</a></li>
                        <li><a href="#" class="hover:text-gray-300">FAQ</a></li>
                    </ul>
                </div>
                <div>
                     <h5 class="font-semibold mb-4">Ikuti Kami</h5>
                     <div class="flex space-x-4">
                        <a href="#" class="hover:text-gray-300">FB</a>
                        <a href="#" class="hover:text-gray-300">IG</a>
                        <a href="#" class="hover:text-gray-300">TW</a>
                        <a href="#" class="hover:text-gray-300">YT</a>
                     </div>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-6 text-center text-sm text-gray-500">
                &copy; 2024 NafasBumi. Dibuat dengan cinta untuk Planet Bumi.
            </div>
        </div>
    </footer>
    
    <div id="error-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white p-8 rounded-lg shadow-xl max-w-sm w-full text-center">
            <h3 class="text-xl font-bold text-red-600 mb-4">Oops, Terjadi Kesalahan!</h3>
            <p id="error-message" class="text-gray-700 mb-6">Maaf, kami tidak dapat memproses permintaan Anda saat ini.</p>
            <button id="close-modal-btn" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700">Tutup</button>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const navLinks = document.querySelectorAll('.nav-link');
            const contentSections = document.querySelectorAll('.content-section');
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            
            const generatePlanBtn = document.getElementById('generate-plan-btn');
            const actionPlanInput = document.getElementById('action-plan-input');
            const planLoader = document.getElementById('plan-loader');
            const planResult = document.getElementById('plan-result');
            
            const exploreTopicBtn = document.getElementById('explore-topic-btn');
            const topicInput = document.getElementById('topic-input');
            const topicLoader = document.getElementById('topic-loader');
            const topicResult = document.getElementById('topic-result');
            
            const errorModal = document.getElementById('error-modal');
            const errorMessage = document.getElementById('error-message');
            const closeModalBtn = document.getElementById('close-modal-btn');

            function updateActiveLink(targetId) {
                navLinks.forEach(link => {
                    link.classList.toggle('active', link.getAttribute('href') === `#${targetId}`);
                });
                
                const mobileNavLinks = mobileMenu.querySelectorAll('.nav-link');
                mobileNavLinks.forEach(link => {
                    link.classList.toggle('active', link.getAttribute('href') === `#${targetId}`);
                });
            }

            function showSection(targetId) {
                contentSections.forEach(section => {
                    section.classList.toggle('hidden', section.id !== targetId);
                });
                updateActiveLink(targetId);
                window.scrollTo(0, 0);
            }
            
            function handleNavClick(event) {
                let targetLink = null;
                if (event.target.matches('a[href^="#"]')) {
                    targetLink = event.target;
                } else if (event.target.closest('a[href^="#"]')) {
                    targetLink = event.target.closest('a[href^="#"]');
                }

                if (targetLink) {
                    event.preventDefault();
                    const targetId = targetLink.getAttribute('href').substring(1);
                    if(document.getElementById(targetId)) {
                        showSection(targetId);
                        if (!mobileMenu.classList.contains('hidden')) {
                           mobileMenu.classList.add('hidden');
                        }
                    } else {
                         showSection('beranda');
                    }
                }
            }
            
            document.body.addEventListener('click', handleNavClick);

            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });
            
            function showErrorModal(message = 'Maaf, terjadi kesalahan tak terduga. Silakan coba lagi nanti.') {
                errorMessage.textContent = message;
                errorModal.classList.remove('hidden');
            }
            
            closeModalBtn.addEventListener('click', () => {
                errorModal.classList.add('hidden');
            });

            async function callGeminiAPI(prompt, isJson = false) {
                const apiKey = "";
                const model = 'gemini-2.0-flash';
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;

                const payload = {
                    contents: [{ role: "user", parts: [{ text: prompt }] }]
                };
                
                if (isJson) {
                    payload.generationConfig = {
                        responseMimeType: "application/json",
                        responseSchema: {
                          type: "OBJECT",
                          properties: {
                            planTitle: { type: "STRING" },
                            steps: {
                              type: "ARRAY",
                              items: {
                                type: "OBJECT",
                                properties: {
                                  title: { type: "STRING" },
                                  description: { type: "STRING" }
                                },
                                required: ["title", "description"]
                              }
                            }
                          },
                          required: ["planTitle", "steps"]
                        }
                    };
                }

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    if (!response.ok) {
                       throw new Error(`API request failed with status ${response.status}`);
                    }

                    const result = await response.json();
                    
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        return result.candidates[0].content.parts[0].text;
                    } else {
                        throw new Error("Respons dari API tidak valid atau kosong.");
                    }
                } catch (error) {
                    console.error("Gemini API Error:", error);
                    showErrorModal(error.message);
                    return null;
                }
            }
            
            generatePlanBtn.addEventListener('click', async () => {
                const topic = actionPlanInput.value.trim();
                if (!topic) {
                    showErrorModal('Silakan masukkan topik untuk rencana aksi Anda.');
                    return;
                }
                
                planLoader.style.display = 'flex';
                planResult.classList.add('hidden');
                generatePlanBtn.disabled = true;

                const prompt = `Buatkan saya rencana aksi ramah lingkungan yang praktis dan dapat ditindaklanjuti untuk topik ini: "${topic}". Fokus pada langkah-langkah yang dapat dilakukan oleh individu di Indonesia. Berikan jawaban dalam format JSON yang valid sesuai skema.`;
                
                const resultText = await callGeminiAPI(prompt, true);
                
                if (resultText) {
                    try {
                        const planData = JSON.parse(resultText);
                        planResult.innerHTML = '';
                        const titleEl = document.createElement('h4');
                        titleEl.className = 'text-xl font-bold mb-4 text-[#2E5339]';
                        titleEl.textContent = planData.planTitle;
                        planResult.appendChild(titleEl);
                        
                        const listEl = document.createElement('ol');
                        listEl.className = 'space-y-4 list-decimal list-inside';
                        planData.steps.forEach(step => {
                            const itemEl = document.createElement('li');
                            itemEl.className = 'bg-stone-50 p-4 rounded-lg';
                            const stepTitle = document.createElement('strong');
                            stepTitle.textContent = step.title;
                            const stepDesc = document.createElement('p');
                            stepDesc.className = 'text-gray-600 text-sm mt-1';
                            stepDesc.textContent = step.description;
                            itemEl.appendChild(stepTitle);
                            itemEl.appendChild(stepDesc);
                            listEl.appendChild(itemEl);
                        });
                        planResult.appendChild(listEl);
                        planResult.classList.remove('hidden');
                    } catch (e) {
                         showErrorModal('Gagal mem-parsing respons dari AI. Silakan coba lagi.');
                    }
                }
                
                planLoader.style.display = 'none';
                generatePlanBtn.disabled = false;
            });

            exploreTopicBtn.addEventListener('click', async () => {
                const topic = topicInput.value.trim();
                if (!topic) {
                    showErrorModal('Silakan masukkan pertanyaan atau topik untuk dijelajahi.');
                    return;
                }
                
                topicLoader.style.display = 'flex';
                topicResult.classList.add('hidden');
                exploreTopicBtn.disabled = true;

                const prompt = `Jelaskan topik lingkungan berikut dengan bahasa yang sederhana, ringkas, dan mudah dipahami untuk audiens umum di Indonesia: "${topic}". Berikan jawaban dalam 2-3 paragraf singkat.`;
                
                const resultText = await callGeminiAPI(prompt);
                
                if (resultText) {
                    topicResult.textContent = resultText;
                    topicResult.classList.remove('hidden');
                }
                
                topicLoader.style.display = 'none';
                exploreTopicBtn.disabled = false;
            });
            
            const ctx = document.getElementById('wasteChart').getContext('2d');
            const wasteChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Plastik', 'Logam', 'Kaca', 'Kain', 'Karet', 'Lainnya'],
                    datasets: [{
                        label: '% Komposisi Sampah Laut',
                        data: [59, 5, 4, 4, 3, 25],
                        backgroundColor: [
                            'rgba(46, 83, 57, 0.7)', 'rgba(119, 136, 153, 0.7)', 'rgba(176, 196, 222, 0.7)',
                            'rgba(244, 164, 96, 0.7)', 'rgba(128, 128, 128, 0.7)', 'rgba(211, 211, 211, 0.7)'
                        ],
                        borderColor: [
                            'rgba(46, 83, 57, 1)', 'rgba(119, 136, 153, 1)', 'rgba(176, 196, 222, 1)',
                             'rgba(244, 164, 96, 1)', 'rgba(128, 128, 128, 1)', 'rgba(211, 211, 211, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y', responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false }, tooltip: { callbacks: { label: (c) => `${c.dataset.label}: ${c.raw}%` } } },
                    scales: { x: { beginAtZero: true, title: { display: true, text: 'Persentase (%)' } }, y: { ticks: { autoSkip: false, callback: function(v) { const l = this.getLabelForValue(v); return l.length > 16 ? l.match(/.{1,16}/g) : l; } } } }
                }
            });
            
            showSection('beranda');
        });
    </script>
</body>
</html>
